define("searchresult:widget/ui/view/RecommendNewsSlider/RecommendNewsSlider.js",function(e){function t(e){this.data=BD.IMG.browserRsData,this.con=e||".news-slider",this.imgHeight=280,this.gap=77,this.padding=50,this.TPL=['<div class="rep-img" data-index="#{imgidx}">','<a href="#{link}" target="_blank">','<img src="#{url}" class="slider-img" alt="#{title}" style="width:#{needWidth}px;height:#{needHeight}px"></img>',"</a>",'<div class="desp">#{summary}',"</div>","</div>"].join("")}var i=e("common:widget/ui/jquery/jquery.js"),n=e("common:widget/ui/slider/slider.js"),s=e("searchresult:widget/ui/view/RecommendNewsSlider/pageresizer.js"),d=e("common:widget/ui/EventEmitter/EventEmitter.js").eventCenter,r=e("searchresult:widget/ui/base/statistic/statistic.js");i.extend(t.prototype,{init:function(){if(this.$con=i(this.con),this.data.photos.length<3)return void this.$con.hide();s.init().start(),this.width=this.$con.width()-this.padding,this.$sliderArea=i('<div class="news-slider-area"></div>').hide(),this.$descCon=i('<div class="news-desc-con"></div>').hide(),this.$title=i('<div class="news-title">全部搜索结果</div>').hide(),this.append().render().show();var e=this;d.on("resizeEnd",function(){e.$sliderArea.children().remove(),e.width=i(window).width()-e.gap-e.padding,e.renderSlider()}),this._createHover(),d.on("sliderCreateEnd",function(){if(e._addEvent(),window.ActiveXObject){var t=navigator.userAgent.toLowerCase(),i=t.match(/msie ([\d.]+)/);if(i&&i.length>1&&(i=0|i[1],11>i))return}e.$sliderCon.append('<span class="shadow-layer"></span>')}),this._addLog()},_createHover:function(){this.hoverLayer=['<div class="news-hover" style="height:#{hoverheight}px">','<div class="news-hover-inner">','<div class="content" style="width:#{contwidth}px;height:#{contheight}px;padding-top:#{paddingtop}px">#{content}',"</div>",'<div class="imgno">',"<span>#{curimgidx}","</span>","/ #{totalimgno}","</div>","</div>","</div>"].join("")},_addLog:function(){r(null,69,{tprn:"recomNews"})},_addEvent:function(){var e=this;this.$sliderCon.on("mouseenter",".slider-cnt .rep-img",function(t){e._onHover(i(this),i(t.fromElement),e)}),this.$sliderCon.on("click",".slider-cnt .rep-img.isOnHover",function(){var e=i(this).find("a").attr("href");return window.open(e),!1}),this.$sliderCon.on("mouseleave",".slider-cnt .rep-img.isOnHover",function(e){i(e.toElement).hasClass("slider-img")||(i(this).removeClass("isOnHover"),i(this).find(".news-hover").remove())})},_onHover:function(e,t,n){if(!e.hasClass("isOnHover")){var s=50,d=260,r=e.find(".slider-img");if(r.css({opacity:1}).animate({opacity:.8},80,function(){i(this).css({opacity:1})}),!e.find(".news-hover").length){var a=r.width()-70,o=20,l=12,c=parseInt(Math.floor(a/l)),p=e.find(".desp").html(),g=p.length/c;g>3?(g=3,p=p.substr(0,g*c).concat("...")):g=parseInt(Math.ceil(g-.08));var v=(60-g*o)/2+10,f={content:p||this.data.desc,contwidth:a,contheight:3*o,hoverheight:3*o+20,paddingtop:v,curimgidx:e.attr("data-index"),totalimgno:0|this.data.photos.length};e.append(h.format(n.hoverLayer,f))}var u=i(".isOnHover",n.$sliderCon),w=0,m=9999,$=e.offset().left,b=e.offset().top,x=0,C=0,y=e.width();u.length&&(u.removeClass("isOnHover"),w=u.offset().left,m=u.offset().top),e.addClass("isOnHover"),m==b&&w==$?C=s:m>b+s?C=s:b-s>m?C=-s:x=w>$?y:-y,i(".news-hover-inner",e).stop().css({left:x+"px",top:C+"px"}).animate({left:0,top:0,easing:"linear"},d),u.length&&(C?C=-C:x>0?x=0-u.width():0>x&&(x=u.width()),i(".news-hover-inner",u).stop().animate({left:x,top:C,easing:"linear"},d,function(){i(".news-hover",u).remove()}))}},render:function(){return this.data.photos.length>0&&(this.renderDesc(),this.renderSlider()),this.renderTitle(),this},renderSlider:function(){var e=[].concat(this.data.photos),t=e.length,n=[];t&&(this.$btn=i('<div class="slider-btn-con"></div>').hide(),this.$sliderCon=i('<div class="slider-con"></div>'),this.$sliderInd=i('<div class="slider-ind"></div>').hide(),this.$frag=i("<div></div>").hide(),this.btnRender(),n=this.adaptData(e,t),t=n.length,this.conRender(n,t),this.indRender(n,t),this.$sliderArea.append(this.$frag).append(this.$btn).append(this.$sliderCon).append(this.$sliderInd).show(),this.createSlider())},createSlider:function(){this.sliderShow=n.init(".slider-con",".slider-cnt",{leftBtnSel:"#news-slide-left-btn",rightBtnSel:"#news-slide-right-btn",autoAnimate:!1,isCycle:!1,isAutoWidth:!0});var e=this.sliderShow.slidesNum,t=i("#news-slide-left-btn"),s=i("#news-slide-right-btn");t.hide(),1==e&&s.hide(),d.trigger("sliderCreateEnd"),d.on("slideMoved",function(i){t.show(),s.show(),0==i.realIdx?t.hide():e-1==i.realIdx&&s.hide()})},btnRender:function(){this.$btn.append('<a href="javascript;" class="slide-btn" id="news-slide-left-btn" hidefocus="true"></a>').append('<a href="javascript;" class="slide-btn" id="news-slide-right-btn" hidefoucs="true"></a>').show()},conRender:function(e,t){var n,s=t||e.length,d=[],r=0,a=this;for(n=0;s>n;n++){d=e[n];var o,l,c=i('<div class="slider-cnt"></div>'),p=d.length,g=0;for(o=0;p>o;o++)l=d[o],l.imgidx=++r,l.link=a.getDetailUrl(a.data.id,l.pn||l.index),1==l.imgidx&&this.$descTitle.find("a:first").attr("href",l.link),g+=l.needWidth,c.append(h.format(a.TPL,l));c.width(g),this.$frag.append(c)}},indRender:function(){},renderDesc:function(){var e='<a href="#" target="_blank">'+(this.data.desc||this.data.query)+"（共"+this.data.photos.length+"张）</a>";this.$descTitle=i('<div class="desc-title"></div>').html(e),this.$descCon.append(this.$descTitle).show()},renderTitle:function(){this.$title.show()},adaptData:function(e,t){var i,n,s=this,d=this.width=this.$con.width()-this.padding,r=0,h=[],a=[],o=[],l=t||e.length;if(!l)return void(s.pageno=0);for(i=0;l>i;i++)n=e[i],n.index=i,n.width-=0,n.height-=0,n.needHeight=s.imgHeight,n.needWidth=Math.floor(n.needHeight*n.width/n.height),r+=n.needWidth,r-Math.floor(n.needWidth/2)<=d?a.push(n):(h.push([].concat(a)),o.push(r-n.needWidth),r=n.needWidth,a=[],a.push(n));if(a.length&&(h.push([].concat(a)),o.push(r),r=0,a=[]),l=h.length)for(i=0;l>i;i++){a=h[i];var c,n,p=o[i],g=a.length,v=0;for(i==l-1&&(d=Math.min(p,d)),rangeWd=d-p,c=0;g>c;c++)n=a[c],n.needWidth+=Math.floor(rangeWd*n.needWidth/p),v+=n.needWidth,i!=l-1&&c==g-1&&v!=d&&(n.needWidth+=d-v)}return h},getDetailUrl:function(e,t){return"http://image.baidu.com/detail/newindex?col="+encodeURIComponent("资讯")+"&tag=&pn=0&pid="+e+"&user_id=10086&setid=-1&sort=0&newsPn="+t+"&fr=search&from=1"},show:function(){this.$con.show()},hide:function(){this.$con.hide()},append:function(){return this.$con.append(this.$sliderArea).append(this.$descCon).append(this.$title),this}});var h=i.extend({},{format:function(e,t){e=String(e);var i=Array.prototype.slice.call(arguments,1),n=Object.prototype.toString;return i.length?(i=1==i.length&&null!==t&&/\[object Array\]|\[object Object\]/.test(n.call(t))?t:i,e.replace(/#\{(.+?)\}/g,function(e,t){var s=i[t];return"[object Function]"==n.call(s)&&(s=s(t)),"undefined"==typeof s?"":s})):e}});return t});